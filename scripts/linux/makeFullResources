#!/bin/bash

ROOT_LOCATION=""
OUTPUT_FILE_NAME=$PWD"/resources_all.cfg"
SECTION_NAME="All"

# Test correct number of arguments
if [ $# -gt 3 ] || [ $# -lt 1 ];
then
    echo "Invalid arguments :S"
    echo "Usage: ./makeFullResource <root_location> [output_file_name] [section_name]"
    echo "where: <root_location> is the root path for the resources tree."
    exit 1
fi


# Set the variables from the input information
if [[ $1 = /* ]]; then
ROOT_LOCATION="$1"
else
ROOT_LOCATION=$PWD"/$1"
fi

if [ $# -gt 1 ]; then
    if [[ $1 = /* ]]; then
        OUTPUT_FILE_NAME="$2"
    else
        OUTPUT_FILE_NAME=$PWD"/$2"
    fi
fi

if [ $# -gt 2 ]
then
    SECTION_NAME="$3"
fi

# Say what we are doing
echo "* Building resources file named    <"$OUTPUT_FILE_NAME">.
* From root path                   <"$ROOT_LOCATION">. 
* Resources placed under section   <"$SECTION_NAME">.";


#clear the output file if it already exists, and write the headers.
>$OUTPUT_FILE_NAME
echo "#Autogenerated file." >> $OUTPUT_FILE_NAME;
echo "#All the resources." >> $OUTPUT_FILE_NAME;
echo "[$SECTION_NAME]" >> $OUTPUT_FILE_NAME;
echo "" >> $OUTPUT_FILE_NAME;


# Fill in with all the resources directories
SAVEDIR=$PWD
cd $ROOT_LOCATION

find . -type d > 12348510154124.txt
while read filename; do
    if [ "$filename" != "." ] ; then
        file="$filename";
        echo "FileSystem="${file#./} >> $OUTPUT_FILE_NAME;
    fi
done < 12348510154124.txt
rm 12348510154124.txt

cd $SAVEDIR


# All done
exit 0

